<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–≥–∞–∑–∏–Ω</title>
<style>
body { font-family: Arial; background:#f0f4f8; padding:20px; }
.box { background:white; padding:20px; border-radius:12px; max-width:420px; margin:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
h3 { text-align:center; margin-bottom:10px; }
input, button, textarea { width:100%; padding:12px; margin-top:8px; font-size:16px; border-radius:8px; border:1px solid #ccc; }
button { background:#4CAF50; color:white; border:none; cursor:pointer; transition:0.2s; }
button:hover { background:#45a049; }
.result { font-weight:bold; margin-top:10px; text-align:center; }
hr { margin:15px 0; }
</style>
</head>
<body>

<div class="box">

<!-- –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
<div id="authBox">
<h3>üîê –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="user" placeholder="–õ–æ–≥–∏–Ω">
<input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
<div class="result" id="result"></div>
</div>

<!-- –ü–æ–∫—É–ø–∞—Ç–µ–ª—å -->
<div id="customerBox" style="display:none">
<h3>üë§ –ü–∞–Ω–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
<p>üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: <b id="customerBalance">0</b> ‚Ç∏</p>

<hr>
<h4>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:</h4>
<input id="code" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="sum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="useCertCustomer()">üí∏ –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</button>

<hr>
<h4>–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –Ω–∞–ø–∏—à–∏—Ç–µ —Ä–µ–ø–æ—Ä—Ç:</h4>
<textarea id="reportText" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." style="height:80px"></textarea>
<button onclick="sendReport()">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–ø–æ—Ä—Ç</button>

<hr>
<button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ -->
<div id="adminBox" style="display:none">
<h3>üëë –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∞</h3>
<p>üí∞ –ë–∞–ª–∞–Ω—Å –º–∞–≥–∞–∑–∏–Ω–∞: <b id="balance">0</b> ‚Ç∏</p>

<hr>
<h4>üéÅ –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h4>
<input id="newCode" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="newSum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="createCert()">–°–æ–∑–¥–∞—Ç—å</button>

<hr>
<h4>üí≥ –°–ø–∏—Å–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h4>
<input id="codeAdmin" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="sumAdmin" type="number" placeholder="–°—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏">
<button onclick="useCertAdmin()">–°–ø–∏—Å–∞—Ç—å</button>

<hr>
<h4>‚ûñ –°–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ —É –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h4>
<input id="targetUser" placeholder="–õ–æ–≥–∏–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è">
<input id="minusSum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="adminTakeMoney()">–°–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏</button>

<hr>
<h4>üìã –†–µ–ø–æ—Ä—Ç—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h4>
<button onclick="showReports()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ–ø–æ—Ä—Ç—ã</button>

<hr>
<button style="margin-top:15px;" onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

</div>

<script>
// ===== –°—Å—ã–ª–∫–∞ –Ω–∞ Web App =====
const CERTS_API = "https://script.google.com/macros/s/AKfycbwxLRY97QuIdFI__mf1BiE1eDkqu1xqNsdhdSnJYTjdgUIVGBgLknoEEOKp1mMKDMJcxw/exec";

// ===== –î–ê–ù–ù–´–ï =====
const admins = { "admin1":"1234", "admin2":"5678" };
let users = {}; // {login:{password, balance}}
let certs = {}; // {code:balance}
let currentUser = "";
let currentRole = "";

// ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø POST =====
async function postData(action, code="", amount=0, comment=""){
  if(!currentUser) return;
  const payload = {action, code, amount, user:currentUser, role:currentRole, comment};
  try{
    await fetch(CERTS_API, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
  }catch(e){
    console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ Web App:", e);
  }
}

// ===== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø =====
function register(){
  const u = user.value.trim();
  const p = pass.value.trim();
  if(!u||!p){ alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å"); return; }
  if(users[u]||admins[u]){ alert("–¢–∞–∫–æ–π –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç"); return; }
  users[u]={password:p,balance:0};
  alert("‚úÖ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
}

// ===== –í–•–û–î =====
function login(){
  const u = user.value.trim();
  const p = pass.value.trim();
  if(admins[u]&&admins[u]===p){
    currentRole="admin"; currentUser=u;
    authBox.style.display="none"; adminBox.style.display="block";
    balance.innerText=0;
    return;
  }
  if(users[u]&&users[u].password===p){
    currentRole="customer"; currentUser=u;
    authBox.style.display="none"; customerBox.style.display="block";
    updateCustomerBalance();
    return;
  }
  alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
}

// ===== –í–´–ô–¢–ò =====
function logout(){
  currentUser=""; currentRole="";
  authBox.style.display="block";
  adminBox.style.display="none";
  customerBox.style.display="none";
  user.value=""; pass.value=""; result.innerText="";
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê =====
function updateCustomerBalance(){ customerBalance.innerText = users[currentUser]?.balance||0; }

// ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢–´ –ü–û–ö–£–ü–ê–¢–ï–õ–ï–ú =====
async function useCertCustomer(){
  let c=code.value.trim();
  let s=Number(sum.value);
  if(!c||!s){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏ —Å—É–º–º—É"); return; }
  certs[c]=(certs[c]||0);
  if(s>certs[c]){ alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  certs[c]-=s;
  users[currentUser].balance=(users[currentUser].balance||0)+s;
  updateCustomerBalance();
  await postData("USE_CUSTOMER",c,s,"–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç");
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω");
  code.value=""; sum.value="";
}

// ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢–´ –ê–î–ú–ò–ù–û–ú =====
async function createCert(){
  let c=newCode.value.trim();
  let s=Number(newSum.value);
  if(!c||!s){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏ —Å—É–º–º—É"); return; }
  certs[c]=(certs[c]||0)+s;
  await postData("CREATE",c,s,"–°–æ–∑–¥–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç");
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω");
  newCode.value=""; newSum.value="";
}

async function useCertAdmin(){
  let c=codeAdmin.value.trim();
  let s=Number(sumAdmin.value);
  if(!certs[c]){ alert("–ù–µ—Ç —Ç–∞–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞"); return; }
  if(s>certs[c]){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  certs[c]-=s;
  await postData("USE_ADMIN",c,s,"–°–ø–∏—Å–∞–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞–¥–º–∏–Ω–æ–º");
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–ø–∏—Å–∞–Ω");
  codeAdmin.value=""; sumAdmin.value="";
}

async function adminTakeMoney(){
  let u=targetUser.value.trim();
  let s=Number(minusSum.value);
  if(!users[u]){ alert("–ù–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"); return; }
  if(s>users[u].balance){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  users[u].balance-=s;
  await postData("ADMIN_TAKE","",s,"–°–ø–∏—Å–∞–Ω–æ —É "+u);
  alert(`‚úÖ –°–ø–∏—Å–∞–Ω–æ ${s} ‚Ç∏ —É ${u}`);
  targetUser.value=""; minusSum.value="";
}

// ===== –†–ï–ü–û–†–¢–´ =====
async function sendReport(){
  const text=reportText.value.trim();
  if(!text){ alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"); return; }
  await postData("REPORT","",0,text);
  alert("‚úÖ –†–µ–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω");
  reportText.value="";
}
</script>

</body>
</html>