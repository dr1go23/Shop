<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞–≥–∞–∑–∏–Ω</title>
<style>
body { font-family: Arial; background:#f0f4f8; padding:20px; }
.box { background:white; padding:20px; border-radius:12px; max-width:420px; margin:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
h3 { text-align:center; margin-bottom:10px; }
input, button, textarea { width:100%; padding:12px; margin-top:8px; font-size:16px; border-radius:8px; border:1px solid #ccc; }
button { background:#4CAF50; color:white; border:none; cursor:pointer; transition:0.2s; }
button:hover { background:#45a049; }
.result { font-weight:bold; margin-top:10px; text-align:center; }
hr { margin:15px 0; }
</style>
</head>
<body>

<div class="box">

<!-- –í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
<div id="authBox">
<h3>üîê –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="user" placeholder="–õ–æ–≥–∏–Ω">
<input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="login()">–í–æ–π—Ç–∏</button>
<button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
<div class="result" id="result"></div>
</div>

<!-- –ü–æ–∫—É–ø–∞—Ç–µ–ª—å -->
<div id="customerBox" style="display:none">
<h3>üë§ –ü–∞–Ω–µ–ª—å –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h3>
<p>üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å: <b id="customerBalance">0</b> ‚Ç∏</p>

<hr>
<h4>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:</h4>
<input id="code" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="sum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="useCertCustomer()">üí∏ –ü–æ—Ç—Ä–∞—Ç–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</button>

<hr>
<h4>–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫, –Ω–∞–ø–∏—à–∏—Ç–µ —Ä–µ–ø–æ—Ä—Ç:</h4>
<textarea id="reportText" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..." style="height:80px;"></textarea>
<button onclick="sendReport()">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–ø–æ—Ä—Ç</button>

<hr>
<button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ -->
<div id="adminBox" style="display:none">
<h3>üëë –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∞</h3>
<p>üí∞ –ë–∞–ª–∞–Ω—Å –º–∞–≥–∞–∑–∏–Ω–∞: <b id="balance">0</b> ‚Ç∏</p>

<hr>
<h4>üéÅ –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h4>
<input id="newCode" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="newSum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="createCert()">–°–æ–∑–¥–∞—Ç—å</button>

<hr>
<h4>üí≥ –°–ø–∏—Å–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h4>
<input id="codeAdmin" placeholder="–ö–æ–¥ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞">
<input id="sumAdmin" type="number" placeholder="–°—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏">
<button onclick="useCertAdmin()">–°–ø–∏—Å–∞—Ç—å</button>

<hr>
<h4>‚ûñ –°–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ —É –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</h4>
<input id="targetUser" placeholder="–õ–æ–≥–∏–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è">
<input id="minusSum" type="number" placeholder="–°—É–º–º–∞">
<button onclick="adminTakeMoney()">–°–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏</button>

<hr>
<h4>üëÄ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (localStorage)</h4>
<textarea id="data" style="height:150px;"></textarea>
<button onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>

<hr>
<h4>üìã –†–µ–ø–æ—Ä—Ç—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h4>
<button onclick="showReports()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ä–µ–ø–æ—Ä—Ç—ã</button>

<button style="margin-top:15px;" onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

</div>

<script>
// ===== –î–ê–ù–ù–´–ï =====
const admins = { "admin1":"1234", "admin2":"5678" };
let users = JSON.parse(localStorage.getItem("users")) || {}; // {login:{password, balance}}
let certs = JSON.parse(localStorage.getItem("certs")) || {};
let reports = JSON.parse(localStorage.getItem("reports")) || [];
let shopBalance = Number(localStorage.getItem("shopBalance")) || 0;

let currentUser = "";
let currentRole = "";

// ===== –°–û–•–†–ê–ù–ï–ù–ò–ï =====
function save() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("certs", JSON.stringify(certs));
  localStorage.setItem("reports", JSON.stringify(reports));
  localStorage.setItem("shopBalance", shopBalance);
}

// ===== –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø =====
function register() {
  const u = user.value.trim();
  const p = pass.value.trim();
  if(!u || !p){ alert("–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å"); return; }
  if(users[u] || admins[u]){ alert("–¢–∞–∫–æ–π –ª–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç"); return; }
  users[u] = { password:p, balance:0 };
  save();
  alert("‚úÖ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω");
}

// ===== –í–•–û–î =====
function login() {
  const u = user.value.trim();
  const p = pass.value.trim();
  // –ê–¥–º–∏–Ω
  if(admins[u] && admins[u]===p){
    currentRole="admin";
    currentUser=u;
    authBox.style.display="none";
    adminBox.style.display="block";
    balance.innerText=shopBalance;
    showData();
    return;
  }
  // –ü–æ–∫—É–ø–∞—Ç–µ–ª—å
  if(users[u] && users[u].password===p){
    currentRole="customer";
    currentUser=u;
    authBox.style.display="none";
    customerBox.style.display="block";
    updateCustomerBalance();
    return;
  }
  alert("‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å");
}

// ===== –í–´–ô–¢–ò =====
function logout() {
  currentUser=""; currentRole="";
  authBox.style.display="block";
  adminBox.style.display="none";
  customerBox.style.display="none";
  user.value=""; pass.value=""; result.innerText="";
}

// ===== –ë–ê–õ–ê–ù–° –ü–û–ö–£–ü–ê–¢–ï–õ–Ø =====
function updateCustomerBalance() {
  customerBalance.innerText = users[currentUser].balance;
}

// ===== –°–ï–†–¢–ò–§–ò–ö–ê–¢–´ =====
function createCert() {
  if(currentRole!=="admin"){ alert("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"); return; }
  let c = newCode.value.trim();
  let s = Number(newSum.value);
  if(!c || !s){ alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏ —Å—É–º–º—É"); return; }
  if(certs[c]){ alert("–¢–∞–∫–æ–π –∫–æ–¥ —É–∂–µ –µ—Å—Ç—å"); return; }
  certs[c]=s;
  save();
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–∑–¥–∞–Ω");
  newCode.value=""; newSum.value="";
}

function useCertAdmin() {
  if(currentRole!=="admin"){ alert("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–ø–∏—Å—ã–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã"); return; }
  let c = codeAdmin.value.trim();
  let s = Number(sumAdmin.value);
  if(!certs[c]){ alert("–ù–µ—Ç —Ç–∞–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞"); return; }
  if(s>certs[c]){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  certs[c]-=s;
  shopBalance+=s;
  balance.innerText=shopBalance;
  save();
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–ø–∏—Å–∞–Ω");
  codeAdmin.value=""; sumAdmin.value="";
}

// ===== –ü–û–¢–†–ê–¢–¨ –°–ï–†–¢–ò–§–ò–ö–ê–¢ –ü–û–ö–£–ü–ê–¢–ï–õ–ï–ú =====
function useCertCustomer() {
  if(currentRole!=="customer"){ alert("‚ùå –¢–æ–ª—å–∫–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"); return; }
  let c = code.value.trim();
  let s = Number(sum.value);
  if(!certs[c]){ alert("‚ùå –ù–µ—Ç —Ç–∞–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞"); return; }
  if(s>certs[c]){ alert("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  certs[c]-=s;
  users[currentUser].balance+=s;
  save();
  updateCustomerBalance();
  alert("‚úÖ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω, –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω");
  code.value=""; sum.value="";
}

// ===== –°–ü–ò–°–ê–¢–¨ –î–ï–ù–¨–ì–ò –£ –ü–û–ö–£–ü–ê–¢–ï–õ–Ø (–ê–î–ú–ò–ù) =====
function adminTakeMoney() {
  if(currentRole!=="admin"){ alert("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç —Å–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏"); return; }
  let u = targetUser.value.trim();
  let s = Number(minusSum.value);
  if(!users[u]){ alert("‚ùå –ù–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è"); return; }
  if(s<=0){ alert("‚ùå –ù–µ–≤–µ—Ä–Ω–∞—è —Å—É–º–º–∞"); return; }
  if(users[u].balance<s){ alert("‚ùå –£ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
  users[u].balance-=s;
  shopBalance+=s;
  balance.innerText=shopBalance;
  save();
  alert(`‚úÖ –°–ø–∏—Å–∞–Ω–æ ${s} ‚Ç∏ —É ${u}`);
  targetUser.value=""; minusSum.value="";
}

// ===== –†–ï–ü–û–†–¢–´ =====
function sendReport() {
  if(currentRole!=="customer"){ alert("‚ùå –¢–æ–ª—å–∫–æ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å —Ä–µ–ø–æ—Ä—Ç"); return; }
  const text = document.getElementById("reportText").value.trim();
  if(!text){ alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç"); return; }
  reports.push({user:currentUser, text:text, date:new Date().toLocaleString()});
  save();
  alert("‚úÖ –†–µ–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω");
  document.getElementById("reportText").value="";
}

function showReports() {
  if(currentRole!=="admin"){ alert("‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Ä–µ–ø–æ—Ä—Ç—ã"); return; }
  if(reports.length===0){ alert("–ù–µ—Ç —Ä–µ–ø–æ—Ä—Ç–æ–≤"); return; }
  let list="";
  reports.forEach((r,i)=>{ list+=`${i+1}. ${r.date} (${r.user}): ${r.text}\n`; });
  alert(list);
}

// ===== –õ–æ–∫–∞–ª —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞ =====
function showData() {
  if(currentRole!=="admin") return;
  data.value = JSON.stringify({users, certs, shopBalance, reports}, null, 2);
}

function saveData() {
  if(currentRole!=="admin") return;
  try{
    let d = JSON.parse(data.value);
    users = d.users || {};
    certs = d.certs || {};
    shopBalance = d.shopBalance || 0;
    reports = d.reports || [];
    save();
    balance.innerText=shopBalance;
    alert("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã");
  }catch(e){ alert("–û—à–∏–±–∫–∞ JSON"); }
}
</script>

</body>
  </html>
